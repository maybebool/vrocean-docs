"use strict";(globalThis.webpackChunkvrocean_docs=globalThis.webpackChunkvrocean_docs||[]).push([[103],{1489(e,n,r){r.r(n),r.d(n,{assets:()=>d,contentTitle:()=>a,default:()=>h,frontMatter:()=>t,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"components/ocean-simulator","title":"OceanSimulator","description":"The OceanSimulator component generates ocean wave displacement and normal textures using Fast Fourier Transform (FFT) algorithms. It runs entirely on the CPU using Burst-compiled jobs for high performance.","source":"@site/docs/components/ocean-simulator.md","sourceDirName":"components","slug":"/components/ocean-simulator","permalink":"/vrocean-docs/docs/components/ocean-simulator","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"sidebar_position":2,"title":"OceanSimulator"},"sidebar":"tutorialSidebar","previous":{"title":"Skybox Setup","permalink":"/vrocean-docs/docs/configuration/skybox-setup"},"next":{"title":"Surface Renderer","permalink":"/vrocean-docs/docs/components/surface-renderer"}}');var s=r(4848),l=r(8453);const t={sidebar_position:2,title:"OceanSimulator"},a="OceanSimulator",d={},c=[{value:"Overview",id:"overview",level:2},{value:"Adding to Scene",id:"adding-to-scene",level:2},{value:"Inspector Fields",id:"inspector-fields",level:2},{value:"Resolution Options",id:"resolution-options",level:3},{value:"Public Properties",id:"public-properties",level:2},{value:"Profile",id:"profile",level:3},{value:"Resolution",id:"resolution",level:3},{value:"DisplacementTexture",id:"displacementtexture",level:3},{value:"NormalTexture",id:"normaltexture",level:3},{value:"DisplacementData",id:"displacementdata",level:3},{value:"Public Methods",id:"public-methods",level:2},{value:"Simulate",id:"simulate",level:3},{value:"FinalizeFrame",id:"finalizeframe",level:3},{value:"Job Pipeline",id:"job-pipeline",level:2},{value:"Memory Layout",id:"memory-layout",level:2},{value:"Native Arrays",id:"native-arrays",level:3},{value:"Memory Usage by Resolution",id:"memory-usage-by-resolution",level:3},{value:"Performance",id:"performance",level:2},{value:"CPU Cost by Resolution",id:"cpu-cost-by-resolution",level:3},{value:"Optimization Tips",id:"optimization-tips",level:3},{value:"Spectrum Regeneration",id:"spectrum-regeneration",level:2},{value:"Integration Without SceneSystem",id:"integration-without-scenesystem",level:2},{value:"Accessing Raw Data",id:"accessing-raw-data",level:2},{value:"Troubleshooting",id:"troubleshooting",level:2},{value:"Textures Are Black",id:"textures-are-black",level:3},{value:"Simulation Stutters",id:"simulation-stutters",level:3},{value:"Memory Errors",id:"memory-errors",level:3},{value:"Jobs Not Completing",id:"jobs-not-completing",level:3},{value:"Next Steps",id:"next-steps",level:2}];function o(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,l.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"oceansimulator",children:"OceanSimulator"})}),"\n",(0,s.jsxs)(n.p,{children:["The ",(0,s.jsx)(n.code,{children:"OceanSimulator"})," component generates ocean wave displacement and normal textures using Fast Fourier Transform (FFT) algorithms. It runs entirely on the CPU using Burst-compiled jobs for high performance."]}),"\n",(0,s.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,s.jsx)(n.p,{children:"OceanSimulator implements a six-stage simulation pipeline:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Spectrum Initialization"})," - Generate initial wave amplitudes from Phillips spectrum"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Temporal Evolution"})," - Advance wave phases based on dispersion relationship"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Horizontal FFT"})," - Transform rows from frequency to spatial domain"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Vertical FFT"})," - Transform columns from frequency to spatial domain"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Displacement Finalization"})," - Apply choppiness and sign correction"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Surface Gradients"})," - Compute normals and foam from displacement field"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"The output is two textures updated each frame: a displacement map and a normal/foam map."}),"\n",(0,s.jsx)(n.h2,{id:"adding-to-scene",children:"Adding to Scene"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"Create a GameObject as a child of your ocean system root"}),"\n",(0,s.jsxs)(n.li,{children:["Name it ",(0,s.jsx)(n.code,{children:"OceanSimulator"})]}),"\n",(0,s.jsxs)(n.li,{children:["Add the ",(0,s.jsx)(n.code,{children:"OceanSimulator"})," component"]}),"\n",(0,s.jsx)(n.li,{children:"Assign a biome profile"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-csharp",children:'using UnityEngine;\r\nusing PlatypusIdeas.VROcean.Runtime.Scripts.Ocean;\r\nusing PlatypusIdeas.VROcean.Runtime.Scripts.Scene;\r\n\r\n// Programmatic setup\r\nGameObject simGo = new GameObject("OceanSimulator");\r\nOceanSimulator simulator = simGo.AddComponent<OceanSimulator>();\r\nsimulator.Profile = myBiomeProfile;\n'})}),"\n",(0,s.jsx)(n.h2,{id:"inspector-fields",children:"Inspector Fields"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Field"}),(0,s.jsx)(n.th,{children:"Type"}),(0,s.jsx)(n.th,{children:"Description"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Profile"}),(0,s.jsx)(n.td,{children:"AquaticBiomeProfile"}),(0,s.jsx)(n.td,{children:"Source of wave configuration"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Editor Updates Enabled"}),(0,s.jsx)(n.td,{children:"bool"}),(0,s.jsx)(n.td,{children:"Allow simulation in edit mode (may cause instability)"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Resolution"}),(0,s.jsx)(n.td,{children:"OceanResolution"}),(0,s.jsx)(n.td,{children:"FFT grid resolution"})]})]})]}),"\n",(0,s.jsx)(n.h3,{id:"resolution-options",children:"Resolution Options"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Value"}),(0,s.jsx)(n.th,{children:"Grid Size"}),(0,s.jsx)(n.th,{children:"Texture Size"}),(0,s.jsx)(n.th,{children:"Performance"}),(0,s.jsx)(n.th,{children:"Quality"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"_16x16"}),(0,s.jsx)(n.td,{children:"16x16"}),(0,s.jsx)(n.td,{children:"16x16"}),(0,s.jsx)(n.td,{children:"Fastest"}),(0,s.jsx)(n.td,{children:"Low detail"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"_32x32"}),(0,s.jsx)(n.td,{children:"32x32"}),(0,s.jsx)(n.td,{children:"32x32"}),(0,s.jsx)(n.td,{children:"Very fast"}),(0,s.jsx)(n.td,{children:"Basic"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"_64x64"}),(0,s.jsx)(n.td,{children:"64x64"}),(0,s.jsx)(n.td,{children:"64x64"}),(0,s.jsx)(n.td,{children:"Fast"}),(0,s.jsx)(n.td,{children:"Good"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"_128x128"}),(0,s.jsx)(n.td,{children:"128x128"}),(0,s.jsx)(n.td,{children:"128x128"}),(0,s.jsx)(n.td,{children:"Moderate"}),(0,s.jsx)(n.td,{children:"High"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"_256x256"}),(0,s.jsx)(n.td,{children:"256x256"}),(0,s.jsx)(n.td,{children:"256x256"}),(0,s.jsx)(n.td,{children:"Slow"}),(0,s.jsx)(n.td,{children:"Very high"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"_512x512"}),(0,s.jsx)(n.td,{children:"512x512"}),(0,s.jsx)(n.td,{children:"512x512"}),(0,s.jsx)(n.td,{children:"Very slow"}),(0,s.jsx)(n.td,{children:"Maximum"})]})]})]}),"\n",(0,s.jsx)(n.p,{children:"For VR on Quest, use 64x64 or 128x128. Higher resolutions provide more wave detail but increase CPU cost significantly."}),"\n",(0,s.jsx)(n.h2,{id:"public-properties",children:"Public Properties"}),"\n",(0,s.jsx)(n.h3,{id:"profile",children:"Profile"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-csharp",children:"public AquaticBiomeProfile Profile { get; set; }\n"})}),"\n",(0,s.jsx)(n.p,{children:"The biome profile providing wave configuration. Changing this triggers spectrum regeneration."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-csharp",children:"// Change profile at runtime\r\nsimulator.Profile = newProfile;\n"})}),"\n",(0,s.jsx)(n.h3,{id:"resolution",children:"Resolution"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-csharp",children:"public int Resolution { get; }\n"})}),"\n",(0,s.jsx)(n.p,{children:"Returns the current grid resolution as an integer."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-csharp",children:"int res = simulator.Resolution; // e.g., 128\r\nint texelCount = res * res;     // e.g., 16384\n"})}),"\n",(0,s.jsx)(n.h3,{id:"displacementtexture",children:"DisplacementTexture"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-csharp",children:"public Texture2D DisplacementTexture { get; }\n"})}),"\n",(0,s.jsxs)(n.p,{children:["The GPU texture containing XYZ displacement values. Format: ",(0,s.jsx)(n.code,{children:"RGBAHalf"}),"."]}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Channel"}),(0,s.jsx)(n.th,{children:"Content"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"R"}),(0,s.jsx)(n.td,{children:"X displacement (horizontal, choppiness)"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"G"}),(0,s.jsx)(n.td,{children:"Y displacement (vertical, wave height)"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"B"}),(0,s.jsx)(n.td,{children:"Z displacement (horizontal, choppiness)"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"A"}),(0,s.jsx)(n.td,{children:"Unused"})]})]})]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-csharp",children:'// Access for custom shader assignment\r\nMaterial customMaterial = GetComponent<Renderer>().material;\r\ncustomMaterial.SetTexture("_WaveDisplacement", simulator.DisplacementTexture);\n'})}),"\n",(0,s.jsx)(n.h3,{id:"normaltexture",children:"NormalTexture"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-csharp",children:"public Texture2D NormalTexture { get; }\n"})}),"\n",(0,s.jsxs)(n.p,{children:["The GPU texture containing surface normals and foam data. Format: ",(0,s.jsx)(n.code,{children:"RGBA32"})," with mipmaps."]}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Channel"}),(0,s.jsx)(n.th,{children:"Content"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"R"}),(0,s.jsx)(n.td,{children:"Normal X (packed, 0-1 range)"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"G"}),(0,s.jsx)(n.td,{children:"Normal Z (packed, 0-1 range)"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"B"}),(0,s.jsx)(n.td,{children:"Jacobian / Foam (0 = folded, 1 = flat)"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"A"}),(0,s.jsx)(n.td,{children:"Smoothness"})]})]})]}),"\n",(0,s.jsx)(n.p,{children:"The texture includes generated mipmaps with filtered normals for distance-based roughness."}),"\n",(0,s.jsx)(n.h3,{id:"displacementdata",children:"DisplacementData"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-csharp",children:"public NativeArray<half4> DisplacementData { get; }\n"})}),"\n",(0,s.jsx)(n.p,{children:"Direct CPU access to displacement values. This is the raw texture data before GPU upload."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-csharp",children:"using Unity.Collections;\r\nusing Unity.Mathematics;\r\n\r\n// Access displacement data for custom physics\r\nNativeArray<half4> data = simulator.DisplacementData;\r\n\r\nif (data.IsCreated)\r\n{\r\n    int index = y * simulator.Resolution + x;\r\n    half4 displacement = data[index];\r\n    \r\n    float heightAtTexel = displacement.y;\r\n}\n"})}),"\n",(0,s.jsxs)(n.p,{children:["This array is valid after ",(0,s.jsx)(n.code,{children:"FinalizeFrame()"})," has been called. Use it for CPU-side water queries in custom systems."]}),"\n",(0,s.jsx)(n.h2,{id:"public-methods",children:"Public Methods"}),"\n",(0,s.jsx)(n.h3,{id:"simulate",children:"Simulate"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-csharp",children:"public void Simulate(Vector3 windVector)\n"})}),"\n",(0,s.jsxs)(n.p,{children:["Advances the simulation by one frame. Called automatically by ",(0,s.jsx)(n.code,{children:"SceneSystem"}),", but can be called manually for custom setups."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-csharp",children:"// Manual simulation control\r\nVector3 wind = new Vector3(5f, 0f, 3f); // Wind direction and speed\r\nsimulator.Simulate(wind);\n"})}),"\n",(0,s.jsx)(n.p,{children:"The method:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"Checks if spectrum needs regeneration (profile or wind changed)"}),"\n",(0,s.jsx)(n.li,{children:"Schedules the job pipeline"}),"\n",(0,s.jsx)(n.li,{children:"Does not block - jobs run asynchronously"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"finalizeframe",children:"FinalizeFrame"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-csharp",children:"public void FinalizeFrame()\n"})}),"\n",(0,s.jsx)(n.p,{children:"Ensures all simulation jobs are complete and textures are uploaded to GPU. Call before rendering."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-csharp",children:"// Ensure simulation is complete before rendering\r\nsimulator.FinalizeFrame();\r\n\r\n// Now safe to use textures\r\nGraphics.Blit(simulator.DisplacementTexture, destination);\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"SceneSystem"})," calls this automatically in ",(0,s.jsx)(n.code,{children:"BeginContextRendering"}),". Only call manually if not using SceneSystem."]}),"\n",(0,s.jsx)(n.h2,{id:"job-pipeline",children:"Job Pipeline"}),"\n",(0,s.jsx)(n.p,{children:"The simulation uses six Burst-compiled jobs scheduled in sequence:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-csharp",children:"// Internal pipeline (simplified)\r\nJobHandle handle = default;\r\n\r\n// Stage 1: Time evolution\r\nhandle = new TemporalEvolutionJob(...).Schedule(texelCount, 64, handle);\r\n\r\n// Stage 2: Horizontal FFT\r\nhandle = new HorizontalSpectralPassJob(...).Schedule(resolution, 1, handle);\r\n\r\n// Stage 3: Vertical FFT\r\nhandle = new VerticalSpectralPassJob(...).Schedule(resolution, 1, handle);\r\n\r\n// Stage 4: Finalize displacement\r\nhandle = new DisplacementFinalizationJob(...).Schedule(texelCount, 64, handle);\r\n\r\n// Stage 5: Surface gradients\r\nhandle = new SurfaceGradientJob(...).Schedule(texelCount, 64, handle);\r\n\r\n// Stage 6: Mipmap generation (multiple jobs)\r\nfor (int mip = 1; mip < mipCount; mip++)\r\n{\r\n    handle = new MipmapFilterJob(...).Schedule(mipTexelCount, 64, handle);\r\n}\r\n\r\nJobHandle.ScheduleBatchedJobs();\n"})}),"\n",(0,s.jsxs)(n.p,{children:["Jobs are scheduled non-blocking and completed in ",(0,s.jsx)(n.code,{children:"FinalizeFrame()"}),"."]}),"\n",(0,s.jsx)(n.h2,{id:"memory-layout",children:"Memory Layout"}),"\n",(0,s.jsx)(n.h3,{id:"native-arrays",children:"Native Arrays"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Array"}),(0,s.jsx)(n.th,{children:"Type"}),(0,s.jsx)(n.th,{children:"Size"}),(0,s.jsx)(n.th,{children:"Purpose"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"_initialAmplitudes"}),(0,s.jsx)(n.td,{children:"float4"}),(0,s.jsx)(n.td,{children:"N*N"}),(0,s.jsx)(n.td,{children:"Initial spectrum"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"_angularFrequencyTable"}),(0,s.jsx)(n.td,{children:"float"}),(0,s.jsx)(n.td,{children:"N*N"}),(0,s.jsx)(n.td,{children:"Dispersion values"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"_heightBufferA/B"}),(0,s.jsx)(n.td,{children:"float2"}),(0,s.jsx)(n.td,{children:"N*N"}),(0,s.jsx)(n.td,{children:"FFT ping-pong"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"_displacementBufferA/B"}),(0,s.jsx)(n.td,{children:"float4"}),(0,s.jsx)(n.td,{children:"N*N"}),(0,s.jsx)(n.td,{children:"FFT ping-pong"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"_finalDisplacement"}),(0,s.jsx)(n.td,{children:"float3"}),(0,s.jsx)(n.td,{children:"N*N"}),(0,s.jsx)(n.td,{children:"Output displacement"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"_normalMipChain"}),(0,s.jsx)(n.td,{children:"float4[]"}),(0,s.jsx)(n.td,{children:"Variable"}),(0,s.jsx)(n.td,{children:"Mipmap chain"})]})]})]}),"\n",(0,s.jsx)(n.p,{children:"Where N = Resolution."}),"\n",(0,s.jsx)(n.h3,{id:"memory-usage-by-resolution",children:"Memory Usage by Resolution"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Resolution"}),(0,s.jsx)(n.th,{children:"Approximate Memory"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"64x64"}),(0,s.jsx)(n.td,{children:"~1.5 MB"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"128x128"}),(0,s.jsx)(n.td,{children:"~6 MB"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"256x256"}),(0,s.jsx)(n.td,{children:"~24 MB"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"512x512"}),(0,s.jsx)(n.td,{children:"~96 MB"})]})]})]}),"\n",(0,s.jsx)(n.p,{children:"Memory is allocated persistently on enable and released on disable."}),"\n",(0,s.jsx)(n.h2,{id:"performance",children:"Performance"}),"\n",(0,s.jsx)(n.h3,{id:"cpu-cost-by-resolution",children:"CPU Cost by Resolution"}),"\n",(0,s.jsx)(n.p,{children:"Measured on Quest 3 (single frame):"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Resolution"}),(0,s.jsx)(n.th,{children:"Job Time"}),(0,s.jsx)(n.th,{children:"Recommended Use"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"64x64"}),(0,s.jsx)(n.td,{children:"~0.3 ms"}),(0,s.jsx)(n.td,{children:"Quest standalone"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"128x128"}),(0,s.jsx)(n.td,{children:"~0.8 ms"}),(0,s.jsx)(n.td,{children:"Quest with headroom"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"256x256"}),(0,s.jsx)(n.td,{children:"~2.5 ms"}),(0,s.jsx)(n.td,{children:"PC VR"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"512x512"}),(0,s.jsx)(n.td,{children:"~8 ms"}),(0,s.jsx)(n.td,{children:"High-end PC only"})]})]})]}),"\n",(0,s.jsx)(n.h3,{id:"optimization-tips",children:"Optimization Tips"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Use appropriate resolution:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-csharp",children:"// Adjust resolution based on platform\r\n#if UNITY_ANDROID\r\n    resolution = OceanResolution._64x64;\r\n#else\r\n    resolution = OceanResolution._128x128;\r\n#endif\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Avoid redundant spectrum regeneration:"}),"\r\nThe spectrum regenerates when wind parameters change. Avoid rapid profile switching or wind changes."]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Profile version tracking:"}),"\r\nThe simulator tracks profile versions to avoid unnecessary regeneration:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-csharp",children:"// Profile.Version increments on inspector changes\r\n// Simulator only regenerates when version changes\n"})}),"\n",(0,s.jsx)(n.h2,{id:"spectrum-regeneration",children:"Spectrum Regeneration"}),"\n",(0,s.jsx)(n.p,{children:"The wave spectrum is regenerated when:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Profile reference changes"}),"\n",(0,s.jsx)(n.li,{children:"Profile version changes (inspector modification)"}),"\n",(0,s.jsx)(n.li,{children:"Wind vector changes (direction or speed)"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"Regeneration is synchronous and may cause a brief hitch. For smooth transitions:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-csharp",children:"// Avoid rapid changes\r\n// Bad: Changing wind every frame\r\nvoid Update()\r\n{\r\n    wind = Mathf.Sin(Time.time) * 10f; // Regenerates every frame!\r\n}\r\n\r\n// Good: Change wind infrequently\r\nvoid ChangeWind(float newSpeed)\r\n{\r\n    if (Mathf.Abs(newSpeed - currentSpeed) > 1f)\r\n    {\r\n        currentSpeed = newSpeed;\r\n        // Spectrum regenerates once\r\n    }\r\n}\n"})}),"\n",(0,s.jsx)(n.h2,{id:"integration-without-scenesystem",children:"Integration Without SceneSystem"}),"\n",(0,s.jsx)(n.p,{children:"OceanSimulator can be used independently:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-csharp",children:'using UnityEngine;\r\nusing PlatypusIdeas.VROcean.Runtime.Scripts.Ocean;\r\nusing PlatypusIdeas.VROcean.Runtime.Scripts.Scene;\r\n\r\npublic class CustomOceanController : MonoBehaviour\r\n{\r\n    [SerializeField] private OceanSimulator simulator;\r\n    [SerializeField] private AquaticBiomeProfile profile;\r\n\r\n    private Vector3 windVector;\r\n\r\n    void Start()\r\n    {\r\n        simulator.Profile = profile;\r\n        UpdateWindVector();\r\n    }\r\n\r\n    void Update()\r\n    {\r\n        // Run simulation\r\n        simulator.Simulate(windVector);\r\n    }\r\n\r\n    void LateUpdate()\r\n    {\r\n        // Finalize before rendering\r\n        simulator.FinalizeFrame();\r\n\r\n        // Apply textures to custom materials\r\n        Shader.SetGlobalTexture("_OceanDisplacement", simulator.DisplacementTexture);\r\n        Shader.SetGlobalTexture("_OceanNormal", simulator.NormalTexture);\r\n    }\r\n\r\n    void UpdateWindVector()\r\n    {\r\n        float yaw = profile.WindYaw * Mathf.Deg2Rad;\r\n        float speed = profile.WaveConfig.WindSpeed;\r\n        windVector = new Vector3(\r\n            Mathf.Sin(yaw) * speed,\r\n            0f,\r\n            Mathf.Cos(yaw) * speed\r\n        );\r\n    }\r\n}\n'})}),"\n",(0,s.jsx)(n.h2,{id:"accessing-raw-data",children:"Accessing Raw Data"}),"\n",(0,s.jsx)(n.p,{children:"For custom physics or effects, access the displacement data directly:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-csharp",children:"using Unity.Collections;\r\nusing Unity.Mathematics;\r\n\r\npublic class CustomWaterSampler : MonoBehaviour\r\n{\r\n    [SerializeField] private OceanSimulator simulator;\r\n\r\n    public float SampleHeight(float2 uv)\r\n    {\r\n        if (!simulator.DisplacementData.IsCreated)\r\n            return 0f;\r\n\r\n        int res = simulator.Resolution;\r\n        NativeArray<half4> data = simulator.DisplacementData;\r\n\r\n        // Bilinear sample\r\n        float u = math.frac(uv.x) * res;\r\n        float v = math.frac(uv.y) * res;\r\n\r\n        int x0 = (int)u;\r\n        int y0 = (int)v;\r\n        int x1 = (x0 + 1) % res;\r\n        int y1 = (y0 + 1) % res;\r\n\r\n        float fx = u - x0;\r\n        float fy = v - y0;\r\n\r\n        float4 c00 = (float4)data[y0 * res + x0];\r\n        float4 c10 = (float4)data[y0 * res + x1];\r\n        float4 c01 = (float4)data[y1 * res + x0];\r\n        float4 c11 = (float4)data[y1 * res + x1];\r\n\r\n        float4 result = math.lerp(\r\n            math.lerp(c00, c10, fx),\r\n            math.lerp(c01, c11, fx),\r\n            fy\r\n        );\r\n\r\n        return result.y; // Height is in Y channel\r\n    }\r\n}\n"})}),"\n",(0,s.jsx)(n.h2,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,s.jsx)(n.h3,{id:"textures-are-black",children:"Textures Are Black"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Verify ",(0,s.jsx)(n.code,{children:"Profile"})," is assigned"]}),"\n",(0,s.jsx)(n.li,{children:"Ensure you are in Play Mode"}),"\n",(0,s.jsxs)(n.li,{children:["Check that ",(0,s.jsx)(n.code,{children:"Simulate()"})," and ",(0,s.jsx)(n.code,{children:"FinalizeFrame()"})," are being called"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"simulation-stutters",children:"Simulation Stutters"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Spectrum is regenerating too often"}),"\n",(0,s.jsx)(n.li,{children:"Check for rapid profile or wind changes"}),"\n",(0,s.jsx)(n.li,{children:"Reduce resolution for your platform"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"memory-errors",children:"Memory Errors"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Resolution too high for available memory"}),"\n",(0,s.jsxs)(n.li,{children:["Reduce resolution or ensure proper cleanup in ",(0,s.jsx)(n.code,{children:"OnDisable"})]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"jobs-not-completing",children:"Jobs Not Completing"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"FinalizeFrame()"})," not called before texture access"]}),"\n",(0,s.jsx)(n.li,{children:"Ensure proper frame timing between Simulate and Finalize"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"next-steps",children:"Next Steps"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"./surface-renderer",children:"Surface Renderer"})," - LOD mesh rendering"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"../optimization/vr-performance",children:"VR Performance"})," - Resolution guidelines"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(o,{...e})}):o(e)}},8453(e,n,r){r.d(n,{R:()=>t,x:()=>a});var i=r(6540);const s={},l=i.createContext(s);function t(e){const n=i.useContext(l);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:t(e.components),i.createElement(l.Provider,{value:n},e.children)}}}]);