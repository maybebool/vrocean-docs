"use strict";(globalThis.webpackChunkvrocean_docs=globalThis.webpackChunkvrocean_docs||[]).push([[119],{2477(e,n,r){r.d(n,{A:()=>i});const i=r.p+"assets/images/surface-renderer-quadtree-9447573d48b98bc325810f725e0e8ddc.png"},4921(e,n,r){r.d(n,{A:()=>i});const i=r.p+"assets/images/surface-renderer-inspector-1566aa9821e3245680fe6520a2cd3e2e.png"},8453(e,n,r){r.d(n,{R:()=>l,x:()=>t});var i=r(6540);const s={},d=i.createContext(s);function l(e){const n=i.useContext(d);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function t(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:l(e.components),i.createElement(d.Provider,{value:n},e.children)}},9080(e,n,r){r.r(n),r.d(n,{assets:()=>c,contentTitle:()=>t,default:()=>o,frontMatter:()=>l,metadata:()=>i,toc:()=>a});const i=JSON.parse('{"id":"components/surface-renderer","title":"Surface Renderer","description":"The SurfaceLodRenderer component handles ocean mesh rendering using a quadtree-based Level of Detail (LOD) system. It generates visible patches each frame, performs frustum culling, and renders using GPU instancing.","source":"@site/docs/components/surface-renderer.md","sourceDirName":"components","slug":"/components/surface-renderer","permalink":"/vrocean-docs/docs/components/surface-renderer","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"sidebar_position":3,"title":"Surface Renderer"},"sidebar":"tutorialSidebar","previous":{"title":"OceanSimulator","permalink":"/vrocean-docs/docs/components/ocean-simulator"},"next":{"title":"Reflection Probe","permalink":"/vrocean-docs/docs/components/reflection-probe"}}');var s=r(4848),d=r(8453);const l={sidebar_position:3,title:"Surface Renderer"},t="Surface Renderer",c={},a=[{value:"Overview",id:"overview",level:2},{value:"Adding to Scene",id:"adding-to-scene",level:2},{value:"Inspector Fields",id:"inspector-fields",level:2},{value:"Required References",id:"required-references",level:3},{value:"Ocean Size",id:"ocean-size",level:3},{value:"Quality",id:"quality",level:3},{value:"Advanced",id:"advanced",level:3},{value:"Debug (Editor Only)",id:"debug-editor-only",level:3},{value:"Quality Presets",id:"quality-presets",level:2},{value:"Public Properties",id:"public-properties",level:2},{value:"SurfaceMaterial",id:"surfacematerial",level:3},{value:"OceanSize",id:"oceansize",level:3},{value:"Quality",id:"quality-1",level:3},{value:"Version",id:"version",level:3},{value:"Public Methods",id:"public-methods",level:2},{value:"RenderForCameras",id:"renderforcameras",level:3},{value:"How Quadtree LOD Works",id:"how-quadtree-lod-works",level:2},{value:"Traversal",id:"traversal",level:3},{value:"LOD Selection",id:"lod-selection",level:3},{value:"Seam Stitching",id:"seam-stitching",level:3},{value:"Horizon Skirting",id:"horizon-skirting",level:2},{value:"Instanced Rendering",id:"instanced-rendering",level:2},{value:"Frustum Culling",id:"frustum-culling",level:2},{value:"Performance",id:"performance",level:2},{value:"Draw Call Efficiency",id:"draw-call-efficiency",level:3},{value:"Vertex Count by Quality",id:"vertex-count-by-quality",level:3},{value:"Optimization Tips",id:"optimization-tips",level:3},{value:"Camera Types",id:"camera-types",level:2},{value:"Debugging",id:"debugging",level:2},{value:"Freeze Quadtree",id:"freeze-quadtree",level:3},{value:"Visualizing LOD",id:"visualizing-lod",level:3},{value:"Profiler Markers",id:"profiler-markers",level:3},{value:"Troubleshooting",id:"troubleshooting",level:2},{value:"Ocean Not Visible",id:"ocean-not-visible",level:3},{value:"Gaps Between Patches",id:"gaps-between-patches",level:3},{value:"Low Frame Rate",id:"low-frame-rate",level:3},{value:"Patches Popping In/Out",id:"patches-popping-inout",level:3},{value:"Horizon Looks Wrong",id:"horizon-looks-wrong",level:3},{value:"Next Steps",id:"next-steps",level:2}];function h(e){const n={a:"a",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,d.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"surface-renderer",children:"Surface Renderer"})}),"\n",(0,s.jsxs)(n.p,{children:["The ",(0,s.jsx)(n.code,{children:"SurfaceLodRenderer"})," component handles ocean mesh rendering using a quadtree-based Level of Detail (LOD) system. It generates visible patches each frame, performs frustum culling, and renders using GPU instancing."]}),"\n",(0,s.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,s.jsx)(n.p,{children:"The renderer implements several optimization techniques:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Quadtree LOD"})," - Subdivides the ocean surface based on camera distance"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Frustum Culling"})," - Only renders patches visible to the camera"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Instanced Rendering"})," - Batches patches to minimize draw calls"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Seam Stitching"})," - Uses 16 mesh variants to prevent T-junction artifacts"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Horizon Skirting"})," - Extends the ocean to the horizon without extra geometry"]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.img,{alt:"Quadtree LOD Visualization",src:r(2477).A+"",width:"1400",height:"742"}),"\r\n",(0,s.jsx)(n.em,{children:"Quadtree subdivision showing higher detail near camera (wireframe view)"})]}),"\n",(0,s.jsx)(n.h2,{id:"adding-to-scene",children:"Adding to Scene"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"Create a GameObject as a child of your ocean system root"}),"\n",(0,s.jsxs)(n.li,{children:["Name it ",(0,s.jsx)(n.code,{children:"SurfaceRenderer"})]}),"\n",(0,s.jsxs)(n.li,{children:["Add the ",(0,s.jsx)(n.code,{children:"SurfaceLodRenderer"})," component"]}),"\n",(0,s.jsx)(n.li,{children:"Assign the ocean material"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-csharp",children:'using UnityEngine;\r\nusing PlatypusIdeas.VROcean.Runtime.Scripts.Ocean;\r\n\r\nGameObject renderGo = new GameObject("SurfaceRenderer");\r\nSurfaceLodRenderer renderer = renderGo.AddComponent<SurfaceLodRenderer>();\r\nrenderer.SurfaceMaterial = oceanMaterial;\r\nrenderer.OceanSize = 1024f;\r\nrenderer.Quality = SurfaceLodRenderer.QualityLevel.Medium;\n'})}),"\n",(0,s.jsx)(n.h2,{id:"inspector-fields",children:"Inspector Fields"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.img,{alt:"SurfaceLodRenderer Inspector",src:r(4921).A+"",width:"629",height:"332"}),"\r\n",(0,s.jsx)(n.em,{children:"SurfaceLodRenderer component with all settings"})]}),"\n",(0,s.jsx)(n.h3,{id:"required-references",children:"Required References"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Field"}),(0,s.jsx)(n.th,{children:"Type"}),(0,s.jsx)(n.th,{children:"Description"})]})}),(0,s.jsx)(n.tbody,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Surface Material"}),(0,s.jsx)(n.td,{children:"Material"}),(0,s.jsx)(n.td,{children:"Ocean shader material for rendering"})]})})]}),"\n",(0,s.jsx)(n.h3,{id:"ocean-size",children:"Ocean Size"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Field"}),(0,s.jsx)(n.th,{children:"Range"}),(0,s.jsx)(n.th,{children:"Default"}),(0,s.jsx)(n.th,{children:"Description"})]})}),(0,s.jsx)(n.tbody,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Ocean Size"}),(0,s.jsx)(n.td,{children:"256 - 8192"}),(0,s.jsx)(n.td,{children:"1024"}),(0,s.jsx)(n.td,{children:"Total ocean extent in world units"})]})})]}),"\n",(0,s.jsxs)(n.p,{children:["The ocean is centered on the camera position and extends ",(0,s.jsx)(n.code,{children:"OceanSize / 2"})," in each direction."]}),"\n",(0,s.jsx)(n.h3,{id:"quality",children:"Quality"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Field"}),(0,s.jsx)(n.th,{children:"Type"}),(0,s.jsx)(n.th,{children:"Description"})]})}),(0,s.jsx)(n.tbody,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Quality"}),(0,s.jsx)(n.td,{children:"QualityLevel"}),(0,s.jsx)(n.td,{children:"Preset controlling mesh density and LOD behavior"})]})})]}),"\n",(0,s.jsx)(n.h3,{id:"advanced",children:"Advanced"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Field"}),(0,s.jsx)(n.th,{children:"Range"}),(0,s.jsx)(n.th,{children:"Default"}),(0,s.jsx)(n.th,{children:"Description"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"LOD Level Override"}),(0,s.jsx)(n.td,{children:"0 - 12"}),(0,s.jsx)(n.td,{children:"0"}),(0,s.jsx)(n.td,{children:"Manual LOD depth (0 = automatic)"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Max Height Override"}),(0,s.jsx)(n.td,{children:"0+"}),(0,s.jsx)(n.td,{children:"0"}),(0,s.jsx)(n.td,{children:"Manual culling bounds height (0 = automatic)"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Skirting Multiplier"}),(0,s.jsx)(n.td,{children:"1 - 20"}),(0,s.jsx)(n.td,{children:"10"}),(0,s.jsx)(n.td,{children:"Horizon extension scale"})]})]})]}),"\n",(0,s.jsx)(n.h3,{id:"debug-editor-only",children:"Debug (Editor Only)"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Field"}),(0,s.jsx)(n.th,{children:"Type"}),(0,s.jsx)(n.th,{children:"Description"})]})}),(0,s.jsx)(n.tbody,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Freeze Quadtree"}),(0,s.jsx)(n.td,{children:"bool"}),(0,s.jsx)(n.td,{children:"Stop LOD updates for debugging"})]})})]}),"\n",(0,s.jsx)(n.h2,{id:"quality-presets",children:"Quality Presets"}),"\n",(0,s.jsxs)(n.p,{children:["The ",(0,s.jsx)(n.code,{children:"Quality"})," setting controls mesh density and LOD transition distances."]}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Preset"}),(0,s.jsx)(n.th,{children:"Vertices Per Patch"}),(0,s.jsx)(n.th,{children:"LOD Threshold"}),(0,s.jsx)(n.th,{children:"Cull Scale"}),(0,s.jsx)(n.th,{children:"Best For"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Low"}),(0,s.jsx)(n.td,{children:"16"}),(0,s.jsx)(n.td,{children:"2.0"}),(0,s.jsx)(n.td,{children:"1.2"}),(0,s.jsx)(n.td,{children:"Quest standalone, low-end"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Medium"}),(0,s.jsx)(n.td,{children:"32"}),(0,s.jsx)(n.td,{children:"1.5"}),(0,s.jsx)(n.td,{children:"1.5"}),(0,s.jsx)(n.td,{children:"Quest, balanced"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"High"}),(0,s.jsx)(n.td,{children:"64"}),(0,s.jsx)(n.td,{children:"1.2"}),(0,s.jsx)(n.td,{children:"1.8"}),(0,s.jsx)(n.td,{children:"PC VR"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Ultra"}),(0,s.jsx)(n.td,{children:"64"}),(0,s.jsx)(n.td,{children:"1.0"}),(0,s.jsx)(n.td,{children:"2.0"}),(0,s.jsx)(n.td,{children:"High-end PC"})]})]})]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Vertices Per Patch"}),": Grid resolution of each rendered patch. Higher values create smoother surfaces but more triangles."]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"LOD Threshold"}),": Distance multiplier for LOD transitions. Lower values increase detail at distance but render more patches."]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Cull Scale"}),": Multiplier for frustum culling bounds. Higher values reduce popping at screen edges but may render off-screen patches."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-csharp",children:"// Set quality based on platform\r\n#if UNITY_ANDROID\r\n    renderer.Quality = SurfaceLodRenderer.QualityLevel.Low;\r\n#elif UNITY_STANDALONE\r\n    renderer.Quality = SurfaceLodRenderer.QualityLevel.High;\r\n#endif\n"})}),"\n",(0,s.jsx)(n.h2,{id:"public-properties",children:"Public Properties"}),"\n",(0,s.jsx)(n.h3,{id:"surfacematerial",children:"SurfaceMaterial"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-csharp",children:"public Material SurfaceMaterial { get; set; }\n"})}),"\n",(0,s.jsx)(n.p,{children:"The material used for ocean rendering. Changing this invalidates the cache and triggers a rebuild."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-csharp",children:"// Switch materials at runtime\r\nrenderer.SurfaceMaterial = stormyOceanMaterial;\n"})}),"\n",(0,s.jsx)(n.h3,{id:"oceansize",children:"OceanSize"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-csharp",children:"public float OceanSize { get; set; }\n"})}),"\n",(0,s.jsx)(n.p,{children:"Total ocean extent in world units. Clamped to 256-8192 range."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-csharp",children:"// Expand ocean for open-world scenarios\r\nrenderer.OceanSize = 4096f;\n"})}),"\n",(0,s.jsx)(n.h3,{id:"quality-1",children:"Quality"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-csharp",children:"public QualityLevel Quality { get; set; }\n"})}),"\n",(0,s.jsx)(n.p,{children:"Current quality preset. Changes trigger mesh rebuild."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-csharp",children:"// Dynamic quality adjustment\r\nif (frameRate < 72f)\r\n{\r\n    renderer.Quality = SurfaceLodRenderer.QualityLevel.Low;\r\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"version",children:"Version"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-csharp",children:"public int Version { get; set; }\n"})}),"\n",(0,s.jsx)(n.p,{children:"Internal version counter. Increment to force mesh rebuild."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-csharp",children:"// Force rebuild after parameter changes\r\nrenderer.Version++;\n"})}),"\n",(0,s.jsx)(n.h2,{id:"public-methods",children:"Public Methods"}),"\n",(0,s.jsx)(n.h3,{id:"renderforcameras",children:"RenderForCameras"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-csharp",children:"public void RenderForCameras(List<Camera> cameras, MaterialPropertyBlock propertyBlock)\n"})}),"\n",(0,s.jsxs)(n.p,{children:["Main rendering entry point. Called by ",(0,s.jsx)(n.code,{children:"SceneSystem"})," during the render pipeline callback."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-csharp",children:'// Manual rendering (if not using SceneSystem)\r\nList<Camera> cameras = new List<Camera> { Camera.main };\r\nMaterialPropertyBlock props = new MaterialPropertyBlock();\r\n\r\n// Set required properties\r\nprops.SetFloat("_OceanRcpScale", 1f / wavePatternSize);\r\nprops.SetFloat("_OceanChoppiness", choppiness);\r\n\r\nrenderer.RenderForCameras(cameras, props);\n'})}),"\n",(0,s.jsx)(n.p,{children:"The method:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"Rebuilds meshes if version changed"}),"\n",(0,s.jsx)(n.li,{children:"Updates quadtree for each camera"}),"\n",(0,s.jsxs)(n.li,{children:["Submits visible patches via ",(0,s.jsx)(n.code,{children:"Graphics.DrawMeshInstanced"})]}),"\n",(0,s.jsx)(n.li,{children:"Renders horizon skirting geometry"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"how-quadtree-lod-works",children:"How Quadtree LOD Works"}),"\n",(0,s.jsx)(n.h3,{id:"traversal",children:"Traversal"}),"\n",(0,s.jsx)(n.p,{children:"Each frame, the renderer traverses a quadtree starting from a single root node covering the entire ocean:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"Calculate node center and size"}),"\n",(0,s.jsx)(n.li,{children:"Measure distance from camera to node"}),"\n",(0,s.jsx)(n.li,{children:"If close enough, subdivide into 4 children"}),"\n",(0,s.jsx)(n.li,{children:"If far enough or at max depth, render the node"}),"\n",(0,s.jsx)(n.li,{children:"Record LOD level in subdivision map for seam stitching"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"Level 0:  [          Root          ]\r\n              \u2193 subdivide\r\nLevel 1:  [ NW ][ NE ][ SW ][ SE ]\r\n              \u2193 subdivide near camera\r\nLevel 2:  [NW][NE][SW][SE] ...\n"})}),"\n",(0,s.jsx)(n.h3,{id:"lod-selection",children:"LOD Selection"}),"\n",(0,s.jsx)(n.p,{children:"The subdivision threshold is calculated as:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"threshold = nodeSize * LODThreshold\r\nshouldSubdivide = distanceToCamera < threshold\n"})}),"\n",(0,s.jsxs)(n.p,{children:["Lower ",(0,s.jsx)(n.code,{children:"LODThreshold"})," values cause subdivision at greater distances, increasing detail."]}),"\n",(0,s.jsx)(n.h3,{id:"seam-stitching",children:"Seam Stitching"}),"\n",(0,s.jsx)(n.p,{children:"When adjacent patches have different LOD levels, their edges have different vertex counts. This creates T-junction artifacts (gaps or cracks)."}),"\n",(0,s.jsx)(n.p,{children:"The renderer solves this with 16 pre-computed mesh variants, one for each combination of edge conditions:"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Flag"}),(0,s.jsx)(n.th,{children:"Direction"}),(0,s.jsx)(n.th,{children:"Meaning"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"East"}),(0,s.jsx)(n.td,{children:"+X"}),(0,s.jsx)(n.td,{children:"Neighbor has coarser LOD"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"North"}),(0,s.jsx)(n.td,{children:"+Z"}),(0,s.jsx)(n.td,{children:"Neighbor has coarser LOD"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"West"}),(0,s.jsx)(n.td,{children:"-X"}),(0,s.jsx)(n.td,{children:"Neighbor has coarser LOD"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"South"}),(0,s.jsx)(n.td,{children:"-Z"}),(0,s.jsx)(n.td,{children:"Neighbor has coarser LOD"})]})]})]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-csharp",children:"// 16 combinations: None, East, North, North|East, West, ...\r\n[Flags]\r\npublic enum AdjacentLodFlags\r\n{\r\n    None = 0,\r\n    East = 1,\r\n    North = 2,\r\n    West = 4,\r\n    South = 8\r\n}\n"})}),"\n",(0,s.jsx)(n.p,{children:"Each variant has adjusted edge triangulation that matches the coarser neighbor."}),"\n",(0,s.jsx)(n.h2,{id:"horizon-skirting",children:"Horizon Skirting"}),"\n",(0,s.jsx)(n.p,{children:"Beyond the detailed LOD region, the renderer draws simple quad strips extending to the horizon. This creates the illusion of infinite ocean without the cost of rendering distant patches."}),"\n",(0,s.jsx)(n.p,{children:"Skirting geometry:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Extends from ",(0,s.jsx)(n.code,{children:"OceanSize / 2"})," to ",(0,s.jsx)(n.code,{children:"OceanSize * SkirtingMultiplier / 2"})]}),"\n",(0,s.jsx)(n.li,{children:"Rendered in 4 directions (N, E, S, W)"}),"\n",(0,s.jsx)(n.li,{children:"Uses the same material but no displacement sampling"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-csharp",children:"// Adjust horizon distance\r\nrenderer.SkirtingMultiplier = 15f; // Extends to 15x ocean size\n"})}),"\n",(0,s.jsx)(n.h2,{id:"instanced-rendering",children:"Instanced Rendering"}),"\n",(0,s.jsxs)(n.p,{children:["Visible patches are batched by mesh variant and rendered with ",(0,s.jsx)(n.code,{children:"Graphics.DrawMeshInstanced"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-csharp",children:"// Internal batching (simplified)\r\nMatrix4x4[][] instanceMatrices = new Matrix4x4[16][]; // 16 submeshes\r\nint[] instanceCounts = new int[16];\r\n\r\n// For each visible patch\r\nint submeshIndex = (int)adjacentFlags;\r\ninstanceMatrices[submeshIndex][count] = patchMatrix;\r\ninstanceCounts[submeshIndex]++;\r\n\r\n// Render each batch\r\nfor (int i = 0; i < 16; i++)\r\n{\r\n    if (instanceCounts[i] > 0)\r\n    {\r\n        Graphics.DrawMeshInstanced(\r\n            patchMesh, \r\n            i,  // submesh index\r\n            material,\r\n            instanceMatrices[i], \r\n            instanceCounts[i],\r\n            propertyBlock\r\n        );\r\n    }\r\n}\n"})}),"\n",(0,s.jsx)(n.p,{children:"Maximum instances per batch: 128. Exceeding this logs a warning."}),"\n",(0,s.jsx)(n.h2,{id:"frustum-culling",children:"Frustum Culling"}),"\n",(0,s.jsx)(n.p,{children:"Each patch is tested against the camera frustum before rendering:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-csharp",children:"// Culling test (simplified)\r\nbool IsNodeVisible(Vector3 center, float size)\r\n{\r\n    Vector3 extents = new Vector3(\r\n        size * cullScale * 0.5f,\r\n        maxHeight * 0.5f,\r\n        size * cullScale * 0.5f\r\n    );\r\n\r\n    // Test against 6 frustum planes\r\n    for (int i = 0; i < 6; i++)\r\n    {\r\n        Vector4 plane = frustumPlanes[i];\r\n        Vector3 testPoint = GetFarthestPointInDirection(center, extents, plane);\r\n        \r\n        if (Vector3.Dot(testPoint, plane) + plane.w < 0)\r\n            return false; // Outside frustum\r\n    }\r\n    return true;\r\n}\n"})}),"\n",(0,s.jsxs)(n.p,{children:["The ",(0,s.jsx)(n.code,{children:"Cull Scale"})," quality parameter expands culling bounds to prevent popping at screen edges."]}),"\n",(0,s.jsx)(n.h2,{id:"performance",children:"Performance"}),"\n",(0,s.jsx)(n.h3,{id:"draw-call-efficiency",children:"Draw Call Efficiency"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Scenario"}),(0,s.jsx)(n.th,{children:"Approximate Draw Calls"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Looking at horizon"}),(0,s.jsx)(n.td,{children:"8-16"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Looking down at water"}),(0,s.jsx)(n.td,{children:"16-32"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Complex scene with reflections"}),(0,s.jsx)(n.td,{children:"32-64"})]})]})]}),"\n",(0,s.jsx)(n.p,{children:"Instancing keeps draw calls low regardless of visible patch count."}),"\n",(0,s.jsx)(n.h3,{id:"vertex-count-by-quality",children:"Vertex Count by Quality"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Quality"}),(0,s.jsx)(n.th,{children:"Vertices/Patch"}),(0,s.jsx)(n.th,{children:"Typical Patches"}),(0,s.jsx)(n.th,{children:"Total Vertices"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Low"}),(0,s.jsx)(n.td,{children:"289"}),(0,s.jsx)(n.td,{children:"20-40"}),(0,s.jsx)(n.td,{children:"5,780 - 11,560"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Medium"}),(0,s.jsx)(n.td,{children:"1,089"}),(0,s.jsx)(n.td,{children:"20-40"}),(0,s.jsx)(n.td,{children:"21,780 - 43,560"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"High"}),(0,s.jsx)(n.td,{children:"4,225"}),(0,s.jsx)(n.td,{children:"20-40"}),(0,s.jsx)(n.td,{children:"84,500 - 169,000"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Ultra"}),(0,s.jsx)(n.td,{children:"4,225"}),(0,s.jsx)(n.td,{children:"30-60"}),(0,s.jsx)(n.td,{children:"126,750 - 253,500"})]})]})]}),"\n",(0,s.jsx)(n.h3,{id:"optimization-tips",children:"Optimization Tips"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Reduce ocean size when possible:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-csharp",children:"// Smaller ocean = fewer LOD levels = faster traversal\r\nrenderer.OceanSize = 512f; // Instead of default 1024\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Use appropriate quality:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-csharp",children:"// Match quality to viewing conditions\r\nif (cameraIsUnderwater)\r\n{\r\n    renderer.Quality = QualityLevel.Low; // Less visible detail needed\r\n}\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Limit LOD levels:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-csharp",children:"// Manual LOD cap for consistent performance\r\nrenderer.LodLevelOverride = 5; // Max 5 levels regardless of ocean size\n"})}),"\n",(0,s.jsx)(n.h2,{id:"camera-types",children:"Camera Types"}),"\n",(0,s.jsx)(n.p,{children:"The renderer processes specific camera types:"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Camera Type"}),(0,s.jsx)(n.th,{children:"Rendered"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Game"}),(0,s.jsx)(n.td,{children:"Yes"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"SceneView"}),(0,s.jsx)(n.td,{children:"Yes"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Reflection"}),(0,s.jsx)(n.td,{children:"Yes"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Preview"}),(0,s.jsx)(n.td,{children:"No"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"VR"}),(0,s.jsx)(n.td,{children:"No (handled as Game)"})]})]})]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-csharp",children:"// Internal camera filter\r\nif (cam.cameraType is not CameraType.Game \r\n    and not CameraType.SceneView \r\n    and not CameraType.Reflection)\r\n{\r\n    continue; // Skip this camera\r\n}\n"})}),"\n",(0,s.jsx)(n.h2,{id:"debugging",children:"Debugging"}),"\n",(0,s.jsx)(n.h3,{id:"freeze-quadtree",children:"Freeze Quadtree"}),"\n",(0,s.jsxs)(n.p,{children:["Enable ",(0,s.jsx)(n.code,{children:"Freeze Quadtree"})," in the inspector to stop LOD updates. Useful for:"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Inspecting current subdivision"}),"\n",(0,s.jsx)(n.li,{children:"Testing seam stitching"}),"\n",(0,s.jsx)(n.li,{children:"Performance profiling without traversal overhead"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"visualizing-lod",children:"Visualizing LOD"}),"\n",(0,s.jsx)(n.p,{children:"The subdivision map stores LOD levels per cell. Access for debugging:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-csharp",children:"// Note: _subdivisionMap is private, but you can visualize via shader\r\n// Pass LOD data to shader for color-coded rendering\n"})}),"\n",(0,s.jsx)(n.h3,{id:"profiler-markers",children:"Profiler Markers"}),"\n",(0,s.jsx)(n.p,{children:"The renderer includes profiler markers:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"LOD Traversal"})," - Quadtree traversal time"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"Patch Submission"})," - Matrix building time"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:'View in Unity Profiler under "Scripts".'}),"\n",(0,s.jsx)(n.h2,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,s.jsx)(n.h3,{id:"ocean-not-visible",children:"Ocean Not Visible"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Verify ",(0,s.jsx)(n.code,{children:"Surface Material"})," is assigned"]}),"\n",(0,s.jsxs)(n.li,{children:["Check camera is within ",(0,s.jsx)(n.code,{children:"OceanSize"})," range"]}),"\n",(0,s.jsxs)(n.li,{children:["Ensure ",(0,s.jsx)(n.code,{children:"RenderForCameras"})," is being called (via SceneSystem or manually)"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"gaps-between-patches",children:"Gaps Between Patches"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Seam stitching mesh variants may not be generated"}),"\n",(0,s.jsxs)(n.li,{children:["Force rebuild by incrementing ",(0,s.jsx)(n.code,{children:"Version"})]}),"\n",(0,s.jsx)(n.li,{children:"Check that all 16 submeshes exist in the patch mesh"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"low-frame-rate",children:"Low Frame Rate"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Reduce ",(0,s.jsx)(n.code,{children:"Quality"})," preset"]}),"\n",(0,s.jsxs)(n.li,{children:["Decrease ",(0,s.jsx)(n.code,{children:"OceanSize"})]}),"\n",(0,s.jsx)(n.li,{children:"Increase LOD threshold (reduces detail at distance)"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"patches-popping-inout",children:"Patches Popping In/Out"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Increase ",(0,s.jsx)(n.code,{children:"Cull Scale"})," in quality preset"]}),"\n",(0,s.jsx)(n.li,{children:"Check for camera near plane issues"}),"\n",(0,s.jsxs)(n.li,{children:["Verify ",(0,s.jsx)(n.code,{children:"Max Height Override"})," covers actual wave height"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"horizon-looks-wrong",children:"Horizon Looks Wrong"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Adjust ",(0,s.jsx)(n.code,{children:"Skirting Multiplier"})," (increase for further horizon)"]}),"\n",(0,s.jsx)(n.li,{children:"Ensure skybox blends with ocean at horizon"}),"\n",(0,s.jsx)(n.li,{children:"Check fog settings"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"next-steps",children:"Next Steps"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"./ocean-simulator",children:"Ocean Simulator"})," - FFT simulation"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"../optimization/quality-presets",children:"Quality Presets"})," - Detailed preset tuning"]}),"\n"]})]})}function o(e={}){const{wrapper:n}={...(0,d.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(h,{...e})}):h(e)}}}]);